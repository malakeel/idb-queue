<!DOCTYPE html>
<html>
    <head>
        <link rel="icon shortcut" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAADmklEQVRIidVVTWwbRRT+Zjz2utl1MMZ1LNoKESTohaRg8XeoFHHhRHvjQKGcgIoD3CoOEJZWFX+qKkRQgVMF4YIAKUiIAxdXQkhArSaNaCkKTWlE7NZ24tj7Ozs7w4GusXfTUI59p933vvd98958qwVu9SBbFSsvVNJBSe5nLHVAQj0sJYoEUISiTUF+FiL8PH2NztU+qQX/W+D+6T37KWUnM9m0oRf1nGZoYIwBAIQQ8Hs+7Lbd417Qk1K8tHhkfu7mBEzQSVTepSl6qHhXUddy2lZDwut5aP/ZtmUoP1pA7TBMyMF6Kt4wOVV5j2ns0Ni9ZT29Lb0lOQAwjUEvGBmv602WxFi+cbr+/Q0FJl57YF+Kpd4au6+spxj9T/IoKCUYyY9krLY1WdpbXrx6uv57VOuvaMqcYh1Yy8Xx4s5sLnvT5IPh93xcu9T6i63Ku6OLZ1FxXXT3pfXM6GbkYSCwvtKx3A1HAwBtdBsv7MzrTBteoZbTkNHYKC/5TwL4GgD+3QOjB4yikduMvH6+4bo994SiYjwU6V1+13uj8dtVJ+Rh4jD6HboBRp/u00YPRKlHtZyWcNXalY6llJpZeLM2PZA+PjFdEe2VtWOle7brsSkIUeqx6L0/gVQoRD4fDK/raCokp+L5tI9Tfs9L2IylGaRCISEAqBQ2Mw4lkjLhx9MZnuEgw54HcN02qu/OPiUldCMMkjvNGtkAgj0Xz7u3iWc1PZtoEEEISmmnP1FfmKoat/wnWGF4TfkdtxsNq/HqxOsPBrqlneA2F2JMvQiodwq78iNxAW77AMGZxARSqFmrZVvxhnSWoby7nAXBUdvgE+Gd4Q4FvF/eXR6J2xQA7JZthULNJgQ2UqNf+o4vuM0TTSEXIISunjta+2nenL9MWeq84CKB444P3+Hc7Wx8lRC4bFY9qsjLreWWo6SKncpyQdTH0buCmrFbljuIUVKhtdy2QcgrSx8s9U0x5JuzR858JkM51/yj6Sr1j4gKFZyuSwXwaYSTrv+F0/WgwusYpdBcajpSyG8WzF9mBzkTxszDOMgd/m3jQt0O3ABO1wEh5NyvZu1KhFl8e3GdEvKj03UQeAEaF+q27/Lv8jAOxvkSX1bVrAoAT+0xH3q+cbFxnFBkZIgP4zgRyJn1lbW9SiEgwOEFs3YSgIrjEv+DKBrV1Vr+kfEZSoI1mfJnm9Xm0O1vf7xwiQpmMR/PnD1W++FGPLd+/A3b7KpRsPlzggAAAABJRU5ErkJggg==" />
        <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
        <meta content="utf-8" http-equiv="encoding">
        <!--
            <link rel="shortcut icon" href="#">
            <script  type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.4.0/Rx.js"></script>
            https://unpkg.com/rxjs@7.5.7/dist/bundles/rxjs.umd.min.js
            -->

            <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/7.2.0/rxjs.umd.js" ></script>

    </head>

    <body>

        this is indexed db test 

        Enter a line to be saved to db:
        <br />
        <input type="text" id="line" name="line" />
        <input type="submit" value="Submit" id="button" /> 
        <br><br>

        <input type="submit" value="Subscribe" id="subscribe" /> 
        <input type="submit" value="Unsubscribe" id="unsubscribe" /> 


        <ul id='results'>

        </ul> 
        <!--
            <script type="module" src="db.js"></script>
            -->

            <script type="module" >
                import { add } from './db.mjs'; 
            import { commandStream} from './db.mjs'; 

            let counter = 0;
            let subscription ;

            const lineInput = document.querySelector('input#line');
            const submitBtn = document.querySelector('#button');

            const subscribeBtn = document.querySelector('#subscribe');

            const unsubscribeBtn = document.querySelector('#unsubscribe');


            subscribe.addEventListener('click' , () => { });

      unsubscribe.addEventListener('click' , () => { });

    let uuid = () => ([1e7]+-1e3+-4e3+-8e3+-1e11)
        .replace(/[018]/g, c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));


            let clickHandler = () => {
                                counter++ ;
                        const n =  Math.floor(Math.random() * 3 + 1) // a random int between 1-3
                       add({ 
                            id: uuid(),
                            timestamp: Date.now(),
                            data: counter + ' ' + lineInput.value,
                            group : n 
                        }).subscribe( 
                            s => {console.log('added ', s);} ,
                            error => console.error(error), 
                            //() => console.log('completed')
                        }; 

            submitBtn.addEventListener('click',  clickHandler) ;

   commandStream.pipe()
        .subscribe ( 
            s => { console.log('streamed ', s) }, 
            err => {console.error(err);},
            () => { console.log('completed takeWhile') } 
    );

//stream.subscribe() ;
            </script>
    </body>
</html>
